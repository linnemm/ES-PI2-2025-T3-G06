<!--Código feito por: Alinne-->

<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cadastro</title>
  <link rel="stylesheet" href="../css/cadastro.css" />
</head>
<body>
    
  <div class="background-box">
    <div class="cadastro-container">
      <!-- Bandeirinhas -->
      <div class="bandeirinhas">
        <div class="flamula">N</div>
        <div class="flamula">O</div>
        <div class="flamula">T</div>
        <div class="flamula">A</div>
        <div class="flamula">D</div>
        <div class="flamula">E</div>
        <div class="flamula">Z</div>
      </div>

      <h1>Cadastro</h1>

      <!-- AVISO DE CAMPOS OBRIGATÓRIOS -->
      <p class="aviso-obrigatorio">* Campo obrigatório</p>

      <!-- Caixas de entrada -->
      <form id="formCadastro">
        <div class="input-wrapper">
          <input type="text" placeholder="Nome" required />
        </div>

        <div class="input-wrapper">
          <input type="text" placeholder="Sobrenome" required />
        </div>

        <div class="input-wrapper">
          <input type="email" placeholder="E-mail" required />
        </div>

        <div class="input-wrapper">
          <input type="tel" placeholder="Telefone" required />
        </div>

        <div class="input-wrapper password-container">
            <input type="password" placeholder="Senha" id="password1" name="senha" required />
            <span id="togglePassword" class="toggle-password"></span>
        </div>

        <div class="input-wrapper password-container">
            <input type="password" placeholder="Confirme a nova senha" id="password2" name="senha" required />
            <span id="togglePassword2" class="toggle-password"></span>
        </div>

        <p id="errorMsg" class="error-message"></p>

        <button type="submit">Cadastrar</button>

        <a href="login.html">Já tem uma conta? Entre aqui</a>
      </form>
    </div>
  </div>

<script>
  const form = document.getElementById('formCadastro');
  const errorMsg = document.getElementById('errorMsg');

  form.addEventListener('submit', async function (e) {
    e.preventDefault();

    const nome = form.querySelector('input[placeholder="Nome"]').value.trim();
    const sobrenome = form.querySelector('input[placeholder="Sobrenome"]').value.trim();
    const email = form.querySelector('input[placeholder="E-mail"]').value.trim();
    const telefone = form.querySelector('input[placeholder="Telefone"]').value.trim();
    const senha1 = document.getElementById('password1').value.trim();
    const senha2 = document.getElementById('password2').value.trim();

    errorMsg.style.display = 'none';
    errorMsg.textContent = '';

    if (senha1.length < 6) {
      errorMsg.textContent = 'A senha deve ter pelo menos 6 caracteres.';
      errorMsg.style.display = 'block';
      return;
    }

    if (senha1 !== senha2) {
      errorMsg.textContent = 'As senhas não coincidem.';
      errorMsg.style.display = 'block';
      return;
    }

    // Monta o corpo da requisição pro backend
    const body = {
      nome,
      sobrenome,
      email,
      telefone,
      senha: senha1
    };

    try {
      const response = await fetch('http://localhost:3000/auth/register', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(body)
      });

      if (response.ok) {
        alert('Cadastro realizado com sucesso!');
        window.location.href = 'login.html';
      } else {
        const data = await response.json();
        errorMsg.textContent = data.message || 'Erro ao cadastrar.';
        errorMsg.style.display = 'block';
      }

    } catch (error) {
      console.error(error);
      errorMsg.textContent = 'Erro de conexão com o servidor.';
      errorMsg.style.display = 'block';
    }
  });
</script>

</body>
</html>