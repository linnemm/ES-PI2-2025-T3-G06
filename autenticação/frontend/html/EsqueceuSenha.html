<!--Código html (Esqueceu a senha) feito por Miriã-->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Esqueceu a senha</title>
    <link rel="stylesheet" href="../css/EsqueceuSenha.css">

</head>

<body>

    <!--Classes-->
    <div class="background-box">
    
    <!-- Quadrado branco dentro do fundo verde -->
    <div class="esqueceu_senha-container">
      <!-- Bandeirinhas -->
      <div class="bandeirinhas">
        <div class="flamula">N</div>
        <div class="flamula">O</div>
        <div class="flamula">T</div>
        <div class="flamula">A</div>
        <div class="flamula">D</div>
        <div class="flamula">E</div>
        <div class="flamula">Z</div>
      </div>

    
      <!--Formulário para o e-mail de redefinir a senha-->
<form id="formEsqueciSenha">
    <h1>Esqueci minha senha</h1>
    <p>Para redefinir sua senha, informe o e-mail 
       cadastrado na sua conta e lhe enviaremos um link para o próximo passo.</p>

    <div class="email">
        <label for="email">E-mail:</label><br>
        <input type="email" placeholder="Digite um e-mail" id="email" name="email" placeholder="email@example.com">
    </div>
    <br><button type="submit">Enviar</button>
</form>
</div>
</div>

<!-- Script de conexão com o backend -->
  <script>
    const form = document.getElementById("formEsqueciSenha");

    form.addEventListener("submit", async (e) => {
      e.preventDefault(); // impede o reload da página

      const email = document.getElementById("email").value.trim();

      if (!email) {
        alert("Por favor, digite um e-mail válido!");
        return;
      }

      // desativa o botão enquanto envia
      const botao = form.querySelector("button");
      botao.disabled = true;
      botao.innerText = "Enviando...";

      try {
        // Faz a requisição pro backend
        const resposta = await fetch("http://localhost:3000/api/auth/forgot-password", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ email }),
        });

        const dados = await resposta.json();

        if (resposta.ok) {
          alert("✅ " + dados.message);
          // backend envia o e-mail de redefinição
          form.reset();
        } else {
          alert("❌ " + (dados.message || "Erro ao enviar o e-mail de recuperação."));
        }
      } catch (erro) {
        console.error("Erro ao conectar com o servidor:", erro);
        alert("Erro ao conectar com o servidor. Verifique se o backend está rodando.");
      } finally {
        // reativa o botão
        botao.disabled = false;
        botao.innerText = "Enviar";
      }
    });
  </script>

</body>
</html>